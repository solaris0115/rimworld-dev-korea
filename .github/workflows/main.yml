name: Wiki Smoke Push (rimworld-dev-korea)

on:
  workflow_dispatch: {}   # 👉 수동 실행 (Actions 탭에서 Run workflow)

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Git 사용자 설정
        run: |
          git config --global user.name  "wiki-bot"
          git config --global user.email "bot@example.com"

      - name: 타겟 위키 클론
        env:
          # 👉 리포 Settings → Secrets and variables → Actions → New repository secret
          # 이름: GH_TOKEN / 값: Fine-grained PAT (Contents: Read/Write, 대상 리포 지정)
          GH_TOKEN: ${{ secrets.GPT_TOKEN }}
        run: |
          git clone https://${GH_TOKEN}@github.com/solaris0115/rimworld-dev-korea.wiki.git target.wiki

      - name: 테스트 파일 생성 및 푸시
        run: |
          cd target.wiki
          echo "last-run: $(date -u +"%Y-%m-%dT%H:%M:%SZ")" > _ping.md
          git add _ping.md
          git commit -m "test(wiki): smoke push"
          # ⚠️ GitHub Wiki 기본 브랜치는 보통 master 입니다. 에러 시 main으로 바꿔서 재시도.
          git push origin master
